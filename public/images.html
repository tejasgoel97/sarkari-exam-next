<!DOCTYPE html>
<html>
<head>
  <title>Image Manager</title>
  <style>
    body { font-family: system-ui; background:#f3f4f6; padding:20px; }
    h2 { margin-top:30px; }
    .grid { display:grid; grid-template-columns:repeat(auto-fill,160px); gap:15px; }
    .card { background:white; padding:10px; border-radius:6px; box-shadow:0 2px 6px rgba(0,0,0,.1); }
    img { width:100%; height:100px; object-fit:cover; }
    button { width:100%; margin-top:5px; }
    .delete { background:#ef4444; color:white; border:none; }
    .copy { background:#2563eb; color:white; border:none; }
  </style>
</head>
<body>

<h1>ðŸ—‚ Image Manager (Month-wise)</h1>
<div id="container"></div>

<script>
async function loadImages() {
  const res = await fetch("/api/upload-image");
  const images = await res.json();

  const grouped = {};
  images.forEach(img => {
    if (!grouped[img.folder]) grouped[img.folder] = [];
    grouped[img.folder].push(img);
  });

  const container = document.getElementById("container");
  container.innerHTML = "";

  Object.keys(grouped).sort().reverse().forEach(folder => {
    const section = document.createElement("div");
    section.innerHTML = `<h2>${folder}</h2><div class="grid"></div>`;
    const grid = section.querySelector(".grid");

    grouped[folder].forEach(img => {
      const card = document.createElement("div");
      card.className = "card";

      card.innerHTML = `
        <img src="${img.url}">
        <div style="font-size:12px; word-break:break-all">${img.filename}</div>
        <button class="copy">Copy URL</button>
        <button class="delete">Delete</button>
      `;

      card.querySelector(".copy").onclick = () => {
        navigator.clipboard.writeText(img.url);
        alert("URL copied");
      };

      card.querySelector(".delete").onclick = async () => {
        if (!confirm("Are you sure you want to delete this image?")) return;

        await fetch("/api/delete-image", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ key: img.key }),
        });

        loadImages();
      };

      grid.appendChild(card);
    });

    container.appendChild(section);
  });
}

loadImages();
</script>
</body>
</html>
